function fadeNav(){setNavOpacity(getScrollY()/(.6*document.documentElement.clientHeight))}function setNavOpacity(e){document.getElementById("navbar").style.background="rgba(19, 21, 22,"+e+")"}function getScrollY(){var e=0;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&(document.body.scrollLeft||document.body.scrollTop)?e=document.body.scrollTop:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(e=document.documentElement.scrollTop),e}function displaySubMenu(){let e=document.getElementsByClassName("cat-sub-menu")[0];var t=e.style.display;e.style.display=""!==t?"":"none"}window.onscroll=fadeNav;const CATEGORIES=["TopRated","Comedy","Action","Sci-Fi"];function createElementWithClass(e,t){let a=document.createElement(e);return a.setAttribute("class",t),a}function getRatingStars(e){e=Math.ceil(2*e)/4;return fullStar='<i class="fas fa-star fa-sm" style="color:#7957ec"></i>',halfStar='<i class="fas fa-star-half-alt fa-sm" style="color:#7957ec"></i>',emptyStar='<i class="fas fa-star fa-sm" style="color:#2a2d2e"></i>',fullStar.repeat(e-e%1)+(e%1!=0?halfStar:"")+emptyStar.repeat(5-Math.ceil(e))}function createMoviesCards(e,r){for(const s of e){let e=createElementWithClass("div","item");e.id=s.id;let t=createElementWithClass("div","item-image");e.appendChild(t);let a=document.createElement("img");a.src=s.image_url,t.appendChild(a);let i=createElementWithClass("div","item-body");e.appendChild(i);let l=createElementWithClass("div","item-title");l.innerHTML=s.title.substr(0,20)+(20<this.length?"&hellip;":""),i.appendChild(l);let n=createElementWithClass("div","item-description");n.innerHTML=s.year+" - "+getRatingStars(s.imdb_score),i.appendChild(n),document.getElementById("carousel-"+r).appendChild(e),addModal(e)}}async function queryPage(e,t){let a=await fetch(e);e=await a.json();return createMoviesCards(e.results,t),e.next}async function getCategory(t){let e=document.getElementById("carousel-"+t),a=document.getElementById("loader-"+t);e.style.display="none";let i=APIURL+"titles/?sort_by=-year;-imdb_score,-votes";"TopRated"!=t&&(i+="&genre="+t);let l=await queryPage(i,t);a.style.display="none",e.style.display="block";for(let e=0;e<5;e++)l=await queryPage(l,t)}async function queryMovieDetails(e){const t=await fetch(APIURL+"titles/"+e);return await t.json()}async function searchFeaturedMovie(e){const t=await fetch(APIURL+"titles/?page="+e+"&sort_by=-year,-imdb_score,-votes");for(var a=(await t.json()).results,i=0;i<a.length;i++)if(300<a[i].votes)return a[i].id;return searchFeaturedMovie(e+1)}async function createFeaturedMovieDiv(){let e=document.getElementsByClassName("featured-container")[0];e.style.display="none";let t=document.getElementById("loader-Featured");var a=await searchFeaturedMovie(page=1);let i=await queryMovieDetails(a);e.style.backgroundImage="url('"+i.image_url.split("_.")[0]+"')",e.setAttribute("id",a);let l=document.getElementsByClassName("featured-name")[0];l.innerHTML=i.title,t.style.display="none",e.style.display="block",addModal(e)}createFeaturedMovieDiv();class Carousel{constructor(e){var l=this;this.targetDiv=e,this.scrollStep=2,this.imagesVisibile=window.innerWidth/232,this.id_list=[],this.items=[],this.currentItem=0,this.root=createElementWithClass("div","carousel"),this.container=createElementWithClass("div","carousel-container"),this.root.setAttribute("tabindex","0"),this.root.appendChild(this.container),this.targetDiv.appendChild(this.root),this.createNavButtons(),new MutationObserver(function(e){e.forEach(function(t){for(var a=0;a<t.addedNodes.length;a++){var i=t.addedNodes[a].id;if(l.id_list.includes(i)||0===i.length)return;l.id_list.push(i),l.items.push(t.addedNodes[a]);let e=createElementWithClass("div","carousel-item");e.appendChild(t.addedNodes[a]),l.container.appendChild(e),l.setCarouselWidth()}})}).observe(this.targetDiv,{childList:!0})}setCarouselWidth(){var e=this.items.length/this.imagesVisibile+1;this.container.style.width=100*e+"%"}createNavButtons(){let e=createElementWithClass("div","carousel-next"),t=createElementWithClass("div","carousel-prev");this.root.appendChild(e),this.root.appendChild(t),e.addEventListener("click",this.next.bind(this)),t.addEventListener("click",this.prev.bind(this))}next(){this.gotoItem(this.currentItem+this.scrollStep)}prev(){this.gotoItem(this.currentItem-this.scrollStep)}gotoItem(e){e<0?e=this.items.length-Math.floor(this.imagesVisibile):(e>=this.items.length||void 0===this.items[this.currentItem+Math.floor(this.imagesVisibile)]&&e>this.currentItem)&&(e=0);var t=-100*e/this.items.length;this.container.style.transform="translate3d("+t+"%, 0, 0)",this.currentItem=e}}function createCarousels(){for(var e=0;e<CATEGORIES.length;e++)carousels.push(new Carousel(document.querySelector("#carousel-"+CATEGORIES[e])))}async function populateCarousels(){for(var e=0;e<CATEGORIES.length;e++)getCategory(CATEGORIES[e])}function onWindowResize(){for(var e=0;e<carousels.length;e++)carousels[e].imagesVisibile=window.innerWidth/232,carousels[e].setCarouselWidth()}window.addEventListener("resize",onWindowResize);var carousels=[];function createHeader(e){let t=createElementWithClass("div","modal-header"),a=document.createElement("img");a.src=e.image_url,a.setAttribute("class","modal-image"),t.appendChild(a);let i=createElementWithClass("div","modal-title");return i.innerHTML=e.title,t.appendChild(i),t}function createDate(e){let t=e;t=t.slice(8,10)+"/"+t.slice(5,7)+"/"+t.slice(0,4);let a=createElementWithClass("span","modal-globaldetails");return a.innerHTML=t,a}function createAgeRating(t){if("Not rated or unkown rating"===t?t="":t+="+",""==t)return null;{let e=createElementWithClass("span","modal-globaldetails");return e.innerHTML=t,e}}function createDuration(e){e<60?e+="min":e=Math.floor(e/60)+"h"+(e-60*Math.floor(e/60))+"min";let t=createElementWithClass("span","modal-globaldetails");return t.innerHTML=e,t}function createCriticsRating(e){let t=createElementWithClass("span","modal-globaldetails");return t.innerHTML=getRatingStars(e),t}function createBoxOffice(t){if(t?1e9<=t?t=(t/1e9).toPrecision(3)+"Md$":1e6<=t?t=(t/1e6).toPrecision(3)+"Mn$":1e3<=t?t=(t/1e3).toPrecision(3)+"k$":t+=" $":t="",""==t)return null;{let e=createElementWithClass("span","modal-globaldetails");return e.innerHTML=t,e}}function createGlobalDetails(e){let t=createElementWithClass("div","modal-global");return t.appendChild(createDate(e.date_published)),ageRating=createAgeRating(e.rated),ageRating&&t.appendChild(ageRating),t.appendChild(createDuration(e.duration)),t.appendChild(createCriticsRating(e.imdb_score)),boxOffice=e.worldwide_gross_income,boxOffice&&t.appendChild(createBoxOffice(e.worldwide_gross_income)),t}function createDescription(e){let t=createElementWithClass("div","modal-summary");return t.innerHTML="<hr>"+e+"<hr>",t}function createAdditionalDetails(e){let t=[],a=createElementWithClass("div","modal-origin");a.innerHTML="<b>Origine:</b> "+e.countries.join(", "),t.push(a);let i=createElementWithClass("div","modal-genre");genreList=e.genres,genreList.length<2?i.innerHTML="<b>Genre:</b> "+e.genres:i.innerHTML="<b>Genres:</b> "+e.genres.join(", "),t.push(i);let l=createElementWithClass("div","modal-director");l.innerHTML="<b>RÃ©alisateur:</b> "+e.directors,t.push(l);let n=createElementWithClass("div","modal-actors");return n.innerHTML="<b>Acteurs:</b> "+e.actors.join(", "),t.push(n),t}function populateModal(e){let t=document.getElementsByClassName("modal-wrapper")[0],a=[];a.push(createHeader(e)),a.push(createGlobalDetails(e)),a.push(createDescription(e.description)),a.push(...createAdditionalDetails(e));for(var i=0;i<a.length;i++)t.appendChild(a[i])}createCarousels(),populateCarousels();const openModal=async function(e){modal=await loadModal(e),loader=document.getElementById("loader-Modal"),loader.style.display="block",populateModal(await queryMovieDetails(e)),loader.style.display="none",modal.style.display=null,modal.removeAttribute("aria-hidden"),modal.setAttribute("aria-modal","true"),modal.addEventListener("click",closeModal),modal.querySelector(".modal-close").addEventListener("click",closeModal)},closeModal=function(e){if(!("modal"!=e.target.className&!e.target.classList.contains("modal-close"))&&null!==modal){e.preventDefault(),modal.removeEventListener("click",closeModal),modal.querySelector(".modal-close").removeEventListener("click",closeModal);const t=function(){modal.style.display="none",modal.removeAttribute("aria-modal"),modal.removeEventListener("animationend",t),modal.querySelector(".modal-wrapper").innerHTML='<div class="loader" id="loader-Modal" style="display: none">',modal=null};modal.addEventListener("animationend",t),modal.setAttribute("aria-hidden","true")}},loadModal=async function(){var e=document.querySelector("#modal");if(null!==e)return e;e=await fetch("src/modal.html#modal").then(e=>e.text()),e=document.createRange().createContextualFragment(e).querySelector("#modal");return document.body.append(e),e};function addModal(e){e.addEventListener("click",function(){openModal(e.id)})}